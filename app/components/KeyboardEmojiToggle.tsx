import React, { useEffect, useRef, useState } from "react";
import { Pressable } from "react-native";
import Svg, { Path } from "react-native-svg";

interface KeyboardEmojiToggleProps {
  isEmojiMode: boolean;
  onToggle: () => void;
  color?: string;
  size?: number;
}

const frames = [
  "M 128 24 C 86.665 23.433 46.907 50.361 31.699 88.728 C 16.121 125.642 24.724 171.077 52.752 199.717 C 80.006 229.056 124.912 239.851 162.523 226.11 C 201.939 212.69 230.885 173.698 231.924 132.014 C 234.025 91.517 209.698 51.465 173.047 34.272 C 159.061 27.502 143.536 23.98 128 24 Z M 128 40 C 166.333 39.31 202.782 66.851 212.669 103.875 C 223.546 140.162 207.734 182.229 175.473 202.16 C 142.584 223.947 95.352 219.464 67.249 191.735 C 38.197 164.997 31.479 118.056 51.638 84.155 C 66.856 57.154 96.986 39.679 128 40 Z M 92 96 C 72.048 95.812 80.815 128.531 98 118.392 C 108.936 112.394 103.701 95.688 92 96 Z M 164 96 C 144.048 95.812 152.815 128.531 170 118.392 C 180.936 112.394 175.701 95.688 164 96 Z M 87.994 144 C 70.261 150.683 89.551 168.97 98.859 175.186 C 120.428 190.306 152.589 185.284 168.852 164.665 C 177.678 158.988 178.917 139.929 164.005 145.068 C 157.982 151.947 153.157 160.647 144.233 164.404 C 127.638 172.691 105.643 166.415 96.31 150.252 C 94.6 147.067 92.032 143.807 87.994 144 Z",
  "M 114.591 27.352 C 77.811 26.864 42.59 51.047 29.506 85.274 C 22.805 107.112 21.305 130.784 24.494 153.565 C 27.683 171.606 36.578 188.554 49.854 200.874 C 82.24 226.115 129.812 235.402 171.11 223.58 C 206.239 212.035 232.158 177.473 233.052 140.392 C 233.956 117.013 229.175 93.729 220.228 72.951 C 211.28 56.914 197.148 43.585 180.164 36.189 C 159.192 30.365 136.897 27.335 114.591 27.352 Z M 48.895 81.34 C 64.968 58.11 93.868 43.076 123.53 43.352 L 132.47 43.352 C 168.428 42.759 202.766 66.453 214.251 98.306 C 223.61 135.484 210.006 177.634 182.251 200.741 C 145.017 219.485 95.443 215.628 62.325 191.772 C 49.828 174.311 42.135 152.505 39.734 129.928 C 37.332 113.31 40.223 95.923 48.895 81.34 M 143.021 96.357 C 141.526 97.299 140.485 98.629 139.846 100.157 C 138.911 101.685 138.39 103.528 138.295 105.471 C 138.201 107.413 138.549 109.439 139.316 111.293 C 140.083 113.148 141.269 114.809 142.796 116.022 C 144.322 117.235 146.173 117.984 148.235 118.053 C 156.705 118.122 165.374 117.628 174.19 116.382 C 177.623 114.662 179.497 111.8 180.06 108.707 C 180.624 105.614 179.859 102.305 178.049 99.728 C 176.238 97.151 173.383 95.33 169.818 95.21 C 169.609 95 169.324 94.883 169.028 94.883 C 159.872 94.859 151.219 95.414 143.021 96.357 M 113.461 101.523 C 105.066 100.133 96.193 99.285 86.972 99.352 L 86.972 99.352 C 83.815 99.325 81.356 100.202 79.577 101.656 C 77.799 103.11 76.717 105.123 76.278 107.331 C 75.839 109.538 76.043 111.917 76.781 114.102 C 77.52 116.287 78.778 118.262 80.41 119.698 C 88.45 121.134 96.854 122.149 105.539 122.442 C 107.816 122.735 110.363 122.188 113.037 120.524 C 115.598 119.025 117.199 116.875 117.942 114.509 C 118.686 112.144 118.572 109.588 117.759 107.276 C 116.945 104.964 115.448 102.914 113.461 101.523 M 160.831 154.695 C 161.07 152.615 160.812 150.603 160.024 148.981 C 159.236 147.36 157.935 146.145 156.126 145.623 C 154.24 145.1 151.858 145.152 148.919 146.036 C 143.738 151.955 139.587 159.44 131.909 162.672 C 117.336 169.801 98.129 164.52 89.889 150.823 C 88.209 148.293 85.882 145.773 82.408 146.235 C 82.408 146.531 82.526 146.815 82.735 147.025 C 67.689 152.984 84.569 168.835 92.873 174.183 C 111.802 187.19 139.843 182.87 154.207 165.131 C 156.022 164.154 157.564 162.599 158.711 160.75 C 159.858 158.901 160.593 156.776 160.831 154.695 M 123.53 158.883 C 123.234 158.883 122.95 159 122.74 159.21 C 122.531 159.419 122.413 159.704 122.413 160 C 122.413 160.296 122.531 160.581 122.74 160.79 C 122.95 161 123.234 161.117 123.53 161.117 L 132.47 161.117 C 132.766 161.117 133.05 161 133.26 160.79 C 133.469 160.581 133.587 160.296 133.587 160 C 133.587 159.704 133.469 159.419 133.26 159.21 C 133.05 159 132.766 158.883 132.47 158.883 L 123.53 158.883 L 123.53 158.883 M 195.441 158.883 C 195.145 158.883 194.861 159 194.651 159.21 C 194.442 159.419 194.324 159.704 194.324 160 C 194.324 160.296 194.442 160.581 194.651 160.79 C 194.861 161 195.145 161.117 195.441 161.117 L 196.559 161.117 C 196.855 161.117 197.139 161 197.349 160.79 C 197.558 160.581 197.676 160.296 197.676 160 C 197.676 159.704 197.558 159.419 197.349 159.21 C 197.139 159 196.855 158.883 196.559 158.883 L 195.441 158.883 L 195.441 158.883",
  "M 49.473 43.632 C 34.812 43.529 21.625 54.38 18.857 68.501 C 17.44 106.761 17.122 145.409 17.797 183.869 C 18.472 194.565 26.089 203.886 35.777 206.492 C 93.089 211.832 153.614 213.797 212.811 211.296 C 227.122 208.854 238.341 195.806 238.53 181.082 C 238.721 142.496 237.71 103.93 235.817 65.894 C 233.924 55.621 225.199 47.066 214.726 45.501 C 159.829 44.269 104.652 43.628 49.473 43.632 Z M 35.574 67.668 C 55.795 62.754 78.729 59.573 101.824 59.632 L 154.176 59.632 C 178.603 59.506 202.688 64.519 221.938 71.258 C 223.917 112.763 221.039 155.321 215.168 193.849 C 156.83 197.815 95.882 196.999 38.416 191.952 C 35.772 154.618 34.144 116.364 33.636 77.948 C 33.128 74.432 33.74 70.754 35.574 67.668 M 74.41 89.768 C 74.094 89.967 73.873 90.249 73.738 90.572 C 71.868 90.895 70.153 91.95 68.95 93.544 C 67.748 95.137 67.156 97.171 67.319 99.235 C 67.481 101.3 68.397 103.257 69.902 104.696 C 71.408 106.135 73.405 106.958 75.513 106.973 C 115.15 106.988 154.829 106.883 194.54 106.62 C 196.938 106.256 198.94 104.985 200.242 103.148 C 201.543 101.312 202.046 99.006 201.664 96.789 C 201.281 94.571 200.012 92.581 198.075 91.373 C 196.848 90.146 195.183 89.456 193.448 89.456 C 153.665 89.451 113.99 89.569 74.41 89.768 M 181.692 116.091 C 142.071 115.797 102.348 115.618 62.552 115.632 L 62.552 115.632 C 60.212 115.626 58.087 116.477 56.528 117.967 C 54.969 119.457 54.075 121.488 53.982 123.627 C 53.89 125.767 54.598 127.875 55.936 129.52 C 57.275 131.165 59.147 132.247 61.164 132.551 C 100.71 132.855 140.333 133.07 180.016 133.132 C 182.17 133.194 184.314 132.413 186.062 130.879 C 187.787 129.379 188.79 127.319 188.948 125.146 C 189.105 122.973 188.416 120.827 187.061 119.156 C 185.707 117.484 183.785 116.385 181.692 116.091 M 90.793 158.878 C 90.843 156.765 90.124 154.734 88.775 153.209 C 87.426 151.683 85.545 150.761 83.49 150.651 C 80.989 150.54 78.382 150.551 75.658 150.738 C 74.562 151.99 73.684 153.574 72.059 154.258 C 67.304 155.766 61.635 155.314 58.709 153.599 C 57.171 154.246 56.014 155.318 55.279 157.088 C 55.279 158.823 55.969 160.488 57.196 161.715 C 55.195 164.158 60.372 168.177 63.801 169.308 C 69.908 172.06 77.943 171.146 83.084 167.393 C 85.14 167.186 87.072 166.192 88.497 164.619 C 89.922 163.045 90.743 160.99 90.793 158.878 M 101.824 153.456 C 100.089 153.456 98.424 154.146 97.197 155.373 C 95.97 156.599 95.28 158.265 95.28 160 C 95.28 161.735 95.97 163.401 97.197 164.627 C 98.424 165.854 100.089 166.544 101.824 166.544 L 154.176 166.544 C 155.911 166.544 157.576 165.854 158.803 164.627 C 160.03 163.401 160.72 161.735 160.72 160 C 160.72 158.265 160.03 156.599 158.803 155.373 C 157.576 154.146 155.911 153.456 154.176 153.456 L 101.824 153.456 L 101.824 153.456 M 192.728 153.456 C 190.993 153.456 189.328 154.146 188.101 155.373 C 186.874 156.599 186.184 158.265 186.184 160 C 186.184 161.735 186.874 163.401 188.101 164.627 C 189.328 165.854 190.993 166.544 192.728 166.544 L 199.272 166.544 C 201.007 166.544 202.672 165.854 203.899 164.627 C 205.126 163.401 205.816 161.735 205.816 160 C 205.816 158.265 205.126 156.599 203.899 155.373 C 202.672 154.146 201.007 153.456 199.272 153.456 L 192.728 153.456 L 192.728 153.456",
  "M 32.94 47.765 C 23.895 47.759 16.303 55.226 16.154 64.242 C 16.077 106.672 16.06 149.122 16.097 191.562 C 16.133 200.394 23.426 207.779 32.203 207.919 C 95.843 208.206 159.656 208.312 223.398 208.177 C 232.424 208.046 239.911 200.461 239.921 191.413 C 239.931 148.965 239.877 106.519 239.775 64.102 C 239.673 55.293 232.321 47.95 223.501 47.866 C 159.991 47.799 96.466 47.765 32.94 47.765 Z M 32.192 64.197 C 53.466 63.933 74.885 63.762 96.313 63.765 L 159.687 63.765 C 181.186 63.758 202.668 64.028 223.889 64.391 C 223.996 106.995 223.841 149.656 223.525 192.1 C 159.829 192.313 95.994 192.269 32.345 191.997 C 32.203 149.618 32.115 107.188 32.088 64.751 C 32.061 64.561 32.094 64.363 32.192 64.197 M 56.991 88.095 C 56.974 88.106 56.962 88.121 56.954 88.138 C 54.847 88.156 52.828 89.011 51.344 90.515 C 49.861 92.02 49.031 94.056 49.04 96.174 C 49.048 98.292 49.896 100.324 51.396 101.82 C 52.896 103.317 54.93 104.159 57.05 104.16 C 104.6 104.161 152.152 104.155 199.706 104.141 C 201.842 104.121 203.876 103.255 205.365 101.737 C 206.855 100.219 207.68 98.169 207.659 96.042 C 207.638 93.916 206.772 91.883 205.249 90.399 C 203.764 88.914 201.748 88.078 199.647 88.078 C 152.09 88.078 104.538 88.084 56.991 88.095 M 199.015 119.79 C 151.466 119.774 103.911 119.764 56.353 119.765 L 56.353 119.765 C 54.22 119.765 52.179 120.608 50.676 122.108 C 49.173 123.607 48.327 125.643 48.322 127.765 C 48.317 129.887 49.153 131.927 50.644 133.434 C 52.135 134.942 54.163 135.798 56.278 135.814 C 103.823 135.831 151.372 135.842 198.925 135.846 C 201.047 135.849 203.089 135.009 204.602 133.507 C 206.114 132.008 206.966 129.97 206.975 127.846 C 206.983 125.723 206.148 123.681 204.656 122.172 C 203.164 120.663 201.134 119.805 199.015 119.79 M 73.011 159.94 C 73.014 157.819 72.177 155.783 70.686 154.282 C 69.194 152.781 67.166 151.933 65.049 151.927 C 62.391 151.921 59.728 151.922 57.058 151.932 C 56.999 151.999 56.952 152.085 56.864 152.121 C 54.601 152.203 52.37 152.976 50.793 154.303 C 49.292 155.757 48.431 157.741 48.392 159.843 C 48.392 161.943 49.227 163.96 50.712 165.445 C 52.023 166.995 54.228 168.01 56.42 168.07 C 59.272 168.218 62.227 168.169 65.027 167.967 C 67.144 167.956 69.175 167.105 70.671 165.601 C 72.166 164.097 73.009 162.06 73.011 159.94 M 96.313 152.078 C 94.213 152.078 92.197 152.914 90.712 154.399 C 89.227 155.884 88.392 157.9 88.392 160 C 88.392 162.1 89.227 164.116 90.712 165.601 C 92.197 167.086 94.213 167.922 96.313 167.922 L 159.687 167.922 C 161.787 167.922 163.803 167.086 165.288 165.601 C 166.773 164.116 167.608 162.1 167.608 160 C 167.608 157.9 166.773 155.884 165.288 154.399 C 163.803 152.914 161.787 152.078 159.687 152.078 L 96.313 152.078 L 96.313 152.078 M 192.039 152.078 C 189.939 152.078 187.923 152.914 186.438 154.399 C 184.953 155.884 184.118 157.9 184.118 160 C 184.118 162.1 184.953 164.116 186.438 165.601 C 187.923 167.086 189.939 167.922 192.039 167.922 L 199.961 167.922 C 202.061 167.922 204.077 167.086 205.562 165.601 C 207.047 164.116 207.882 162.1 207.882 160 C 207.882 157.9 207.047 155.884 205.562 154.399 C 204.077 152.914 202.061 152.078 199.961 152.078 L 192.039 152.078 L 192.039 152.078",
  "M 32 48 C 23.274 48 16 55.274 16 64 C 16 106.667 16 149.333 16 192 C 16 200.726 23.274 208 32 208 C 96 208 160 208 224 208 C 232.726 208 240 200.726 240 192 C 240 149.333 240 106.667 240 64 C 240 55.274 232.726 48 224 48 C 160 48 96 48 32 48 Z M 32 64 C 53.333 64 74.667 64 96 64 L 160 64 C 181.333 64 202.667 64 224 64 C 224 106.667 224 149.333 224 192 C 160 192 96 192 32 192 C 32 149.333 32 106.667 32 64 C 32 64 32 64 32 64 M 56 88 C 56 88 56 88 56 88 C 53.879 88 51.843 88.843 50.343 90.343 C 48.843 91.843 48 93.879 48 96 C 48 98.121 48.843 100.157 50.343 101.657 C 51.843 103.157 53.879 104 56 104 C 104 104 152 104 200 104 C 202.121 104 204.157 103.157 205.657 101.657 C 207.157 100.157 208 98.121 208 96 C 208 93.879 207.157 91.843 205.657 90.343 C 204.157 88.843 202.121 88 200 88 C 152 88 104 88 56 88 M 200 120 C 152 120 104 120 56 120 L 56 120 C 53.879 120 51.843 120.843 50.343 122.343 C 48.843 123.843 48 125.879 48 128 C 48 130.121 48.843 132.157 50.343 133.657 C 51.843 135.157 53.879 136 56 136 C 104 136 152 136 200 136 C 202.121 136 204.157 135.157 205.657 133.657 C 207.157 132.157 208 130.121 208 128 C 208 125.879 207.157 123.843 205.657 122.343 C 204.157 120.843 202.121 120 200 120 M 72 160 C 72 157.879 71.157 155.843 69.657 154.343 C 68.157 152.843 66.121 152 64 152 C 61.333 152 58.667 152 56 152 C 56 152 56 152 56 152 C 53.879 152 51.843 152.843 50.343 154.343 C 48.843 155.843 48 157.879 48 160 C 48 162.121 48.843 164.157 50.343 165.657 C 51.843 167.157 53.879 168 56 168 C 58.667 168 61.333 168 64 168 C 66.121 168 68.157 167.157 69.657 165.657 C 71.157 164.157 72 162.121 72 160 M 96 152 C 93.879 152 91.843 152.843 90.343 154.343 C 88.843 155.843 88 157.879 88 160 C 88 162.121 88.843 164.157 90.343 165.657 C 91.843 167.157 93.879 168 96 168 L 160 168 C 162.121 168 164.157 167.157 165.657 165.657 C 167.157 164.157 168 162.121 168 160 C 168 157.879 167.157 155.843 165.657 154.343 C 164.157 152.843 162.121 152 160 152 L 96 152 L 96 152 M 192 152 C 189.879 152 187.843 152.843 186.343 154.343 C 184.843 155.843 184 157.879 184 160 C 184 162.121 184.843 164.157 186.343 165.657 C 187.843 167.157 189.879 168 192 168 L 200 168 C 202.121 168 204.157 167.157 205.657 165.657 C 207.157 164.157 208 162.121 208 160 C 208 157.879 207.157 155.843 205.657 154.343 C 204.157 152.843 202.121 152 200 152 L 192 152 L 192 152",
];

export default function KeyboardEmojiToggle({
  isEmojiMode,
  onToggle,
  color = "#007AFF",
  size = 24,
}: KeyboardEmojiToggleProps) {
  const [frameIndex, setFrameIndex] = useState(
    isEmojiMode ? frames.length - 1 : 0,
  );

  const animationRef = useRef<number | null>(null);
  const targetFrame = isEmojiMode ? frames.length - 1 : 0;

  useEffect(() => {
    if (animationRef.current) {
      cancelAnimationFrame(animationRef.current);
    }

    if (frameIndex === targetFrame) return;

    const fps = 30;
    const frameDuration = 1000 / fps;

    let lastTimestamp: number | null = null;

    function step(timestamp: number) {
      if (!lastTimestamp) lastTimestamp = timestamp;

      const elapsed = timestamp - lastTimestamp;

      if (elapsed >= frameDuration) {
        setFrameIndex((current) => {
          if (current === targetFrame) {
            return current;
          }
          return current < targetFrame ? current + 1 : current - 1;
        });
        lastTimestamp = timestamp;
      }

      if (frameIndex !== targetFrame) {
        animationRef.current = requestAnimationFrame(step);
      }
    }

    animationRef.current = requestAnimationFrame(step);

    return () => {
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
      }
    };
  }, [isEmojiMode, frameIndex, targetFrame]);

  useEffect(() => {
    setFrameIndex(isEmojiMode ? frames.length - 1 : 0);
  }, [isEmojiMode]);

  return (
    <Pressable
      onPress={onToggle}
      style={{
        padding: 8,
        borderRadius: 12,
        alignItems: "center",
        justifyContent: "center",
      }}
    >
      <Svg width={size} height={size} viewBox="0 0 256 256">
        <Path d={frames[frameIndex]} fill={color} fillRule="evenodd" />
      </Svg>
    </Pressable>
  );
}
